<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeTrack Pro - Habit Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéØ</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        html, body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            scroll-behavior: smooth;
        }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .gradient-vape { background: linear-gradient(135deg, #3b82f6, #1e3a8a); }
        .gradient-cigarette { background: linear-gradient(135deg, #f59e0b, #b45309); }
        .gradient-urge { background: linear-gradient(135deg, #8b5cf6, #5b21b6); }
        .gradient-premium { background: linear-gradient(135deg, #10b981, #047857); }

        .nav-btn.active svg, .nav-btn.active span { color: #60a5fa; font-weight: 600; }
        .modal-bg { background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); }
        .lang-btn.active { background-color: #3b82f6; color: white; }
        .tab-btn.active { color: #3b82f6; border-color: #3b82f6; }
        .achievement-locked { filter: grayscale(100%); opacity: 0.5; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col">

    <!-- Main Content Area -->
    <main class="flex-grow p-4 pb-24">

        <!-- ===== Dashboard Page ===== -->
        <div id="dashboardPage" class="page active">
            <header class="mb-6">
                <h1 data-lang-key="dashboard_title" class="text-3xl font-bold text-slate-100">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
                <p data-lang-key="dashboard_subtitle" class="text-slate-400">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶≠‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</p>
            </header>
            <div id="dashboardGrid" class="space-y-4"></div>
        </div>

        <!-- ===== Insights Page ===== -->
        <div id="insightsPage" class="page">
            <header class="mb-6">
                <h1 data-lang-key="insights_title" class="text-3xl font-bold text-slate-100">‡¶á‡¶®‡¶∏‡¶æ‡¶á‡¶ü</h1>
                <p data-lang-key="insights_subtitle" class="text-slate-400">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶ì ‡¶Ö‡¶∞‡ßç‡¶ú‡¶®</p>
            </header>
            <div class="mb-4">
                <select id="insightsTrackerSelect" class="w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
            </div>
            <!-- Sub-navigation tabs -->
            <div class="mb-4 border-b border-slate-700 flex">
                <button data-tab="charts" data-lang-key="tab_charts" class="tab-btn insights-tab-btn active flex-1 py-2 font-semibold border-b-2 transition-colors">‡¶ö‡¶æ‡¶∞‡ßç‡¶ü</button>
                <button data-tab="history" data-lang-key="tab_history" class="tab-btn insights-tab-btn flex-1 py-2 font-semibold border-b-2 border-transparent text-slate-400 transition-colors">‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</button>
                <button data-tab="achievements" data-lang-key="tab_achievements" class="tab-btn insights-tab-btn flex-1 py-2 font-semibold border-b-2 border-transparent text-slate-400 transition-colors">‡¶Ö‡¶∞‡ßç‡¶ú‡¶®</button>
            </div>
            
            <div id="chartsTab" class="insights-tab-content">
                <div class="bg-slate-800 p-4 rounded-xl shadow-lg">
                    <canvas id="mainChart"></canvas>
                </div>
                 <div id="statsSummary" class="mt-4 grid grid-cols-2 gap-4 text-center"></div>
            </div>

            <div id="historyTab" class="insights-tab-content hidden space-y-3"></div>
            <div id="achievementsTab" class="insights-tab-content hidden grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
        </div>

        <!-- ===== Motivation Page ===== -->
        <div id="motivationPage" class="page"></div>

        <!-- ===== Settings Page ===== -->
        <div id="settingsPage" class="page">
            <header class="mb-6">
                <h1 data-lang-key="settings_title" class="text-3xl font-bold text-slate-100">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h1>
                <p data-lang-key="settings_subtitle" class="text-slate-400">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®</p>
            </header>
            <div id="settingsContainer" class="space-y-6"></div>
        </div>
    </main>

    <!-- Bottom Navigation & Floating Action Button -->
    <div class="fixed bottom-0 left-0 right-0 h-20">
        <div class="relative h-full">
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-20">
                <button id="addEntryBtn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg transform transition-transform active:scale-90">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </button>
            </div>
            <nav class="absolute bottom-0 left-0 right-0 bg-slate-800/80 backdrop-blur-sm border-t border-slate-700 grid grid-cols-5 items-center h-16 z-10">
                <button data-page="dashboardPage" class="nav-btn flex flex-col items-center justify-center text-slate-400 active"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg><span data-lang-key="nav_dashboard" class="text-xs mt-1">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</span></button>
                <button data-page="insightsPage" class="nav-btn flex flex-col items-center justify-center text-slate-400"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><span data-lang-key="nav_insights" class="text-xs mt-1">‡¶á‡¶®‡¶∏‡¶æ‡¶á‡¶ü</span></button>
                <div class="w-full"></div>
                <button data-page="motivationPage" class="nav-btn flex flex-col items-center justify-center text-slate-400"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg><span data-lang-key="nav_motivation" class="text-xs mt-1">‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ</span></button>
                <button data-page="settingsPage" class="nav-btn flex flex-col items-center justify-center text-slate-400"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0 3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg><span data-lang-key="nav_settings" class="text-xs mt-1">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</span></button>
            </nav>
        </div>
    </div>
    
    <!-- Add Entry Modal -->
    <div id="addEntryModal" class="fixed inset-0 modal-bg flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-2xl shadow-xl p-6 w-11/12 max-w-sm">
            <h2 data-lang-key="modal_log_title" class="text-2xl font-bold mb-2 text-center">‡¶≤‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div id="modalTrackerList" class="space-y-3 my-4"></div>
            <textarea id="entryNote" data-lang-key-placeholder="note_placeholder" class="w-full bg-slate-700 p-2 rounded-md h-20 text-sm" placeholder="‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡ßã‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)..."></textarea>
            <button id="saveEntryBtn" data-lang-key="save_button" class="mt-4 w-full font-bold py-3 px-4 rounded-md text-white bg-blue-600 hover:bg-blue-700">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button id="closeModalBtn" data-lang-key="close_button" class="mt-2 text-slate-400 text-sm w-full py-1">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Achievement Unlocked Toast -->
    <div id="toast" class="fixed top-5 right-5 bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-500 z-50"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
    // --- DICTIONARY FOR BILINGUAL SUPPORT ---
    const strings = {
        dashboard_title: { bn: '‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°', en: 'Dashboard' },
        dashboard_subtitle: { bn: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶≠‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™', en: 'A summary of your habits' },
        insights_title: { bn: '‡¶á‡¶®‡¶∏‡¶æ‡¶á‡¶ü', en: 'Insights' },
        insights_subtitle: { bn: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶ì ‡¶Ö‡¶∞‡ßç‡¶ú‡¶®', en: 'Your progress & achievements' },
        motivation_title: { bn: '‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ', en: 'Motivation' },
        motivation_subtitle: { bn: '‡¶ï‡¶†‡¶ø‡¶® ‡¶∏‡¶Æ‡ßü‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ', en: 'Your companion in tough times' },
        settings_title: { bn: '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏', en: 'Settings' },
        settings_subtitle: { bn: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®', en: 'Customize the app for you' },
        nav_dashboard: { bn: '‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°', en: 'Dashboard' },
        nav_insights: { bn: '‡¶á‡¶®‡¶∏‡¶æ‡¶á‡¶ü', en: 'Insights' },
        nav_motivation: { bn: '‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ', en: 'Motivation' },
        nav_settings: { bn: '‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏', en: 'Settings' },
        modal_log_title: { bn: '‡¶≤‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Log an Entry' },
        note_placeholder: { bn: '‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡ßã‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)...', en: 'Add a note (optional)...' },
        save_button: { bn: '‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Save Entry' },
        close_button: { bn: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Close' },
        timer_start: { bn: '‡¶è‡¶ñ‡¶®‡¶á ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®!', en: 'Start now!' },
        timer_prefix: { bn: '‡¶∂‡ßá‡¶∑‡¶¨‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶∞‡¶§', en: 'Abstinent For' },
        today_count_label: { bn: '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ó‡¶£‡¶®‡¶æ', en: 'Today\'s Count' },
        total_count_label: { bn: '‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶ó‡¶£‡¶®‡¶æ', en: 'Total Count' },
        money_saved_label: { bn: '‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶∏‡¶û‡ßç‡¶ö‡ßü', en: 'Est. Money Saved' },
        tab_charts: { bn: '‡¶ö‡¶æ‡¶∞‡ßç‡¶ü', en: 'Charts' },
        tab_history: { bn: '‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏', en: 'History' },
        tab_achievements: { bn: '‡¶Ö‡¶∞‡ßç‡¶ú‡¶®', en: 'Achievements' },
        history_empty: { bn: '‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§', en: 'No history yet.' },
        settings_daily_limit: { bn: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø', en: 'Daily Limit' },
        settings_old_avg: { bn: '‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶ó‡ßú ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ (‡¶¶‡ßà‡¶®‡¶ø‡¶ï)', en: 'Previous Daily Average' },
        settings_cost: { bn: '‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü/‡¶≤‡¶ø‡¶ï‡ßÅ‡¶á‡¶°‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ (‡ß≥)', en: 'Cost of Pack/Liquid (BDT)' },
        settings_units: { bn: '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü‡ßá ‡¶á‡¶â‡¶®‡¶ø‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ', en: 'Units per Pack' },
        settings_save_btn: { bn: '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Save Settings' },
        settings_lang_label: { bn: '‡¶≠‡¶æ‡¶∑‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®', en: 'Change Language' },
        settings_export_title: { bn: '‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü', en: 'Data Management' },
        settings_export_subtitle: { bn: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶®‡•§', en: 'Backup all your data.' },
        settings_export_btn: { bn: '‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Export Data' },
        settings_danger_zone: { bn: '‡¶¨‡¶ø‡¶™‡¶¶‡¶ú‡¶®‡¶ï ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ', en: 'Danger Zone' },
        settings_reset_subtitle: { bn: '‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®! ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§', en: 'Warning! This will erase all your saved data.' },
        settings_reset_btn: { bn: '‡¶∏‡¶¨ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', en: 'Reset All Data' },
        confirm_reset: { bn: '‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§', en: 'Are you sure you want to delete all your data? This action cannot be undone.' },
        achievement_unlocked: { bn: '‡¶Ö‡¶∞‡ßç‡¶ú‡¶® ‡¶Ü‡¶®‡¶≤‡¶ï‡¶°!', en: 'Achievement Unlocked!' },
        motivation_tips_title: { bn: '‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶ï‡¶∞‡¶£‡ßÄ‡ßü', en: 'Quick Tips' },
        motivation_quotes_title: { bn: '‡¶Ö‡¶®‡ßÅ‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶£‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶â‡¶ï‡ßç‡¶§‡¶ø', en: 'Motivational Quotes' },
        tip1: { bn: '<strong>‡¶ó‡¶≠‡ßÄ‡¶∞ ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®:</strong> ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∂‡ßç‡¶¨‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®, ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®, ‡¶è‡¶¨‡¶Ç ‡ß≠ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ß‡¶∞‡ßá ‡¶õ‡¶æ‡ßú‡ßÅ‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡¶ï‡ßá ‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶ï‡¶∞‡¶¨‡ßá‡•§', en: '<strong>Deep Breath:</strong> Inhale for 5 seconds, hold, and exhale for 7 seconds. It will calm your mind.' },
        tip2: { bn: '<strong>‡¶™‡¶æ‡¶®‡¶ø ‡¶™‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</strong> ‡¶è‡¶ï ‡¶ó‡ßç‡¶≤‡¶æ‡¶∏ ‡¶†‡¶æ‡¶®‡ßç‡¶°‡¶æ ‡¶™‡¶æ‡¶®‡¶ø ‡¶™‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßã‡¶Ø‡ßã‡¶ó ‡¶Ö‡¶®‡ßç‡¶Ø‡¶¶‡¶ø‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶¨‡ßá‡•§', en: '<strong>Drink Water:</strong> Drink a glass of cold water. It will distract your attention.' },
        tip3: { bn: '<strong>‡¶è‡¶ï‡¶ü‡ßÅ ‡¶π‡ßá‡¶Å‡¶ü‡ßá ‡¶Ü‡¶∏‡ßÅ‡¶®:</strong> ‡ß´-‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶¨‡¶æ ‡¶ò‡¶∞‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá‡¶á ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶π‡¶æ‡¶Å‡¶ü‡ßÅ‡¶®‡•§ ‡¶∂‡¶æ‡¶∞‡ßÄ‡¶∞‡¶ø‡¶ï ‡¶®‡ßú‡¶æ‡¶ö‡ßú‡¶æ ‡¶Æ‡¶æ‡¶®‡¶∏‡¶ø‡¶ï ‡¶ö‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶æ‡ßü‡•§', en: '<strong>Take a Walk:</strong> Walk outside or even inside for 5-10 minutes. Physical movement reduces stress.' },
        tip4: { bn: '<strong>‡¶Æ‡¶®‡ßã‡¶Ø‡ßã‡¶ó ‡¶∏‡¶∞‡¶æ‡¶®:</strong> ‡¶ó‡¶æ‡¶® ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®, ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶´‡ßã‡¶® ‡¶¶‡¶ø‡¶® ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', en: '<strong>Distract Yourself:</strong> Listen to music, call a friend, or do something you enjoy.' },
        tip5: { bn: '<strong>‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶Æ‡¶®‡ßá ‡¶ï‡¶∞‡ßÅ‡¶®:</strong> ‡¶≠‡¶æ‡¶¨‡ßÅ‡¶®, ‡¶ï‡ßá‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶Ö‡¶≠‡ßç‡¶Ø‡¶æ‡¶∏‡¶ü‡¶ø ‡¶õ‡¶æ‡ßú‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ö‡ßÇ‡ßú‡¶æ‡¶®‡ßç‡¶§ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∂‡¶ï‡ßç‡¶§‡¶ø ‡¶ú‡ßã‡¶ó‡¶æ‡¶¨‡ßá‡•§', en: '<strong>Remember Your Goal:</strong> Think about why you wanted to quit this habit. Your ultimate goal will give you strength.' },
        quote1: { bn: '"‡¶è‡¶ó‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶∞‡¶π‡¶∏‡ßç‡¶Ø ‡¶π‡¶≤‡ßã ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡•§" <cite class="block text-right text-sm text-slate-400 mt-2">- ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶ü‡ßã‡ßü‡ßá‡¶®</cite>', en: '"The secret of getting ahead is getting started." <cite class="block text-right text-sm text-slate-400 mt-2">- Mark Twain</cite>' },
        quote2: { bn: '"‡¶Ø‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶•‡¶æ‡¶Æ‡¶õ‡ßá‡¶® ‡¶®‡¶æ, ‡¶§‡¶§‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶§ ‡¶ß‡ßÄ‡¶∞‡ßá ‡¶è‡¶ó‡ßã‡¶ö‡ßç‡¶õ‡ßá‡¶® ‡¶∏‡ßá‡¶ü‡¶æ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶∑‡ßü ‡¶®‡ßü‡•§" <cite class="block text-right text-sm text-slate-400 mt-2">- ‡¶ï‡¶®‡¶´‡ßÅ‡¶∏‡¶ø‡ßü‡¶æ‡¶∏</cite>', en: '"It does not matter how slowly you go as long as you do not stop." <cite class="block text-right text-sm text-slate-400 mt-2">- Confucius</cite>' },
    };
    let currentLang = 'bn';

    let appData = {};
    let mainChartInstance = null;
    let timerIntervals = {};
    let selectedTrackerForModal = null;

    const defaultData = {
        settings: { language: 'bn' },
        trackers: {
            vape: { 
                id: 'vape', 
                name: 'Vape Tracker', 
                icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`, 
                gradient: 'gradient-vape', 
                history: [], 
                settings: { dailyLimit: 20, oldAvg: 60, cost: 500, units: 1500, unitName: {bn: '‡¶™‡¶æ‡¶´', en: 'Puffs'} } 
            },
            cigarette: { 
                id: 'cigarette', 
                name: 'Cigarette Tracker', 
                icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-1.414 1.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-1.414-1.414A1 1 0 006.586 13H4"></path></svg>`, 
                gradient: 'gradient-cigarette', 
                history: [], 
                settings: { dailyLimit: 10, oldAvg: 20, cost: 300, units: 20, unitName: {bn: '‡¶ü‡¶ø', en: 'Sticks'} } 
            }
            /*
            urge: { 
                id: 'urge', 
                name: 'Urge Tracker', 
                icon: `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`, 
                gradient: 'gradient-urge', 
                history: [], 
                settings: { dailyLimit: 2, oldAvg: 5, cost: 0, units: 0, unitName: {bn: '‡¶¨‡¶æ‡¶∞', en: 'Times'} } 
            }
            */
        },
        achievements: { vape: {}, cigarette: {} /*, urge: {}*/ }
    };
    
    const achievementConfig = {
        '1d_free': { name: { en: '24 Hours Free', bn: '‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§' }, icon: 'ü•â', duration: 24 * 3600 * 1000 },
        '3d_free': { name: { en: '3 Days Strong', bn: '‡ß© ‡¶¶‡¶ø‡¶® ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ' }, icon: 'ü•â', duration: 3 * 24 * 3600 * 1000 },
        '7d_free': { name: { en: '1 Week Milestone', bn: '‡ßß ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶á‡¶≤‡¶´‡¶≤‡¶ï' }, icon: 'ü•à', duration: 7 * 24 * 3600 * 1000 },
        '30d_free': { name: { en: '1 Month Champion', bn: '‡ßß ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶™‡¶ø‡ßü‡¶®' }, icon: 'ü•á', duration: 30 * 24 * 3600 * 1000 },
    };
    
    // --- DOM ELEMENTS ---
    const pages = document.querySelectorAll('.page');
    const navButtons = document.querySelectorAll('.nav-btn');
    const addEntryBtn = document.getElementById('addEntryBtn');
    const addEntryModal = document.getElementById('addEntryModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const saveEntryBtn = document.getElementById('saveEntryBtn');
    const entryNote = document.getElementById('entryNote');
    const insightsTabButtons = document.querySelectorAll('.insights-tab-btn');
    const insightsTabContents = document.querySelectorAll('.insights-tab-content');
    const toastEl = document.getElementById('toast');
    
    const saveData = () => localStorage.setItem('lifeTrackProData', JSON.stringify(appData));
    const loadData = () => {
        const data = localStorage.getItem('lifeTrackProData');
        appData = data ? JSON.parse(data) : JSON.parse(JSON.stringify(defaultData));
    };
    
    function setLanguage(lang) {
        currentLang = lang;
        if (appData && appData.settings) {
            appData.settings.language = lang;
        }
        saveData();
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-lang-key]').forEach(el => {
            const key = el.dataset.langKey;
            if (strings[key] && strings[key][currentLang]) {
                el.innerHTML = strings[key][currentLang];
            }
        });
        document.querySelectorAll('[data-lang-key-placeholder]').forEach(el => {
            const key = el.dataset.langKeyPlaceholder;
            if(strings[key] && strings[key][currentLang]) {
                el.placeholder = strings[key][currentLang];
            }
        });
        const activePage = document.querySelector('.page.active').id;
        renderAllPages();
        switchPage(activePage, true); // force re-render
    }

    function logEntry(trackerId, note) {
        if (!trackerId) return;
        appData.trackers[trackerId].history.push({ timestamp: Date.now(), note: note });
        saveData();
        checkAllAchievements();
        renderDashboard();
        closeModal();
    }

    function checkAllAchievements() {
        Object.keys(appData.trackers).forEach(trackerId => {
            const tracker = appData.trackers[trackerId];
            const history = tracker.history;
            if (history.length === 0) return;
            const lastEntryTime = history[history.length - 1].timestamp;
            const timeSince = Date.now() - lastEntryTime;

            Object.keys(achievementConfig).forEach(achieveId => {
                const config = achievementConfig[achieveId];
                if (timeSince >= config.duration && !(appData.achievements[trackerId] && appData.achievements[trackerId][achieveId])) {
                    if (!appData.achievements[trackerId]) appData.achievements[trackerId] = {};
                    appData.achievements[trackerId][achieveId] = true;
                    saveData();
                    const unlockedText = strings['achievement_unlocked'][currentLang];
                    showToast(`${unlockedText}<br>${tracker.name}: ${config.name[currentLang]}`);
                }
            });
        });
    }

    function renderAllPages() {
        renderMotivationPage();
        renderSettingsPage();
    }

    function renderDashboard() {
        const grid = document.getElementById('dashboardGrid');
        grid.innerHTML = '';
        Object.values(appData.trackers).forEach(tracker => {
            const todayStart = new Date().setHours(0, 0, 0, 0);
            const countToday = tracker.history.filter(entry => entry.timestamp >= todayStart).length;
            const lastEntry = tracker.history.length > 0 ? tracker.history[tracker.history.length - 1].timestamp : null;
            const unitName = tracker.settings.unitName[currentLang] || tracker.settings.unitName['en'];

            const card = document.createElement('div');
            card.className = `p-4 rounded-xl shadow-lg text-white ${tracker.gradient}`;
            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-xl font-bold">${tracker.name}</h2>
                        <p class="text-sm opacity-80">${strings['today_count_label'][currentLang]}: <strong>${countToday} / ${tracker.settings.dailyLimit}</strong> ${unitName}</p>
                    </div>
                    <div class="p-2 bg-white/20 rounded-lg">${tracker.icon}</div>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-sm opacity-80">${strings['timer_prefix'][currentLang]}</p>
                    <p id="timer-${tracker.id}" class="text-2xl font-semibold">${strings['timer_start'][currentLang]}</p>
                </div>`;
            grid.appendChild(card);
            startTimer(tracker.id, lastEntry);
        });
    }

    function renderInsightsPage(trackerId) {
        const select = document.getElementById('insightsTrackerSelect');
        const currentSelection = trackerId || select.value || Object.keys(appData.trackers)[0];
        select.innerHTML = '';
        Object.values(appData.trackers).forEach(tracker => {
            const option = document.createElement('option');
            option.value = tracker.id;
            option.textContent = tracker.name;
            select.appendChild(option);
        });
        select.value = currentSelection;
        
        const activeTab = document.querySelector('.insights-tab-btn.active').dataset.tab;
        switchInsightsTab(activeTab, currentSelection);
    }
    
    function renderStatsSummary(trackerId) {
        const summaryEl = document.getElementById('statsSummary');
        const tracker = appData.trackers[trackerId];
        const history = tracker.history;
        
        const totalEntries = history.length;
        const todayStart = new Date().setHours(0,0,0,0);
        const todayEntries = history.filter(e => e.timestamp >= todayStart).length;
        
        let moneySaved = 0;
        if(tracker.settings.cost > 0 && tracker.settings.units > 0){
            const costPerUnit = tracker.settings.cost / tracker.settings.units;
            const startDate = history.length > 0 ? new Date(history[0].timestamp) : new Date();
            const days = Math.max(1, (Date.now() - startDate.getTime()) / (1000 * 3600 * 24));
            const expectedEntries = Math.floor(days * tracker.settings.oldAvg);
            const savedEntries = expectedEntries - totalEntries;
            moneySaved = savedEntries > 0 ? (savedEntries * costPerUnit).toFixed(2) : 0;
        }

        summaryEl.innerHTML = `
            <div class="bg-slate-800 p-3 rounded-lg"><p class="text-slate-400 text-sm">${strings.today_count_label[currentLang]}</p><p class="font-bold text-xl">${todayEntries}</p></div>
            <div class="bg-slate-800 p-3 rounded-lg"><p class="text-slate-400 text-sm">${strings.total_count_label[currentLang]}</p><p class="font-bold text-xl">${totalEntries}</p></div>
            <div class="bg-slate-800 p-3 rounded-lg col-span-2"><p class="text-slate-400 text-sm">${strings.money_saved_label[currentLang]}</p><p class="font-bold text-xl text-green-400">‡ß≥${moneySaved}</p></div>`;
    }

    function renderMainChart(trackerId) {
        const tracker = appData.trackers[trackerId];
        const ctx = document.getElementById('mainChart').getContext('2d');
        
        const dataPoints = tracker.history.reduce((acc, entry) => {
            const date = new Date(entry.timestamp).setHours(0,0,0,0);
            acc[date] = (acc[date] || 0) + 1;
            return acc;
        }, {});

        const labels = Object.keys(dataPoints).map(ts => new Date(parseInt(ts)));
        const data = Object.values(dataPoints);

        if (mainChartInstance) mainChartInstance.destroy();
        mainChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: `${tracker.name} (${tracker.settings.unitName[currentLang]})`,
                    data: data,
                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1,
                    borderRadius: 5,
                }]
            },
            options: { responsive: true, scales: { x: { type: 'time', time: { unit: 'day' }, ticks: { color: '#9ca3af' } }, y: { beginAtZero: true, ticks: { color: '#9ca3af', stepSize: 1 } } } }
        });
    }

    function renderHistory(trackerId) {
        const history = appData.trackers[trackerId].history.slice().reverse();
        const container = document.getElementById('historyTab');
        if (history.length === 0) {
            container.innerHTML = `<p class="text-slate-400 text-center">${strings.history_empty[currentLang]}</p>`;
            return;
        }
        container.innerHTML = history.map(entry => `
            <div class="bg-slate-800 p-3 rounded-lg">
                <p class="font-semibold">${new Date(entry.timestamp).toLocaleString()}</p>
                ${entry.note ? `<p class="text-sm text-slate-300 mt-1 pl-2 border-l-2 border-slate-600">${entry.note}</p>` : ''}
            </div>
        `).join('');
    }

    function renderAchievements(trackerId) {
        const container = document.getElementById('achievementsTab');
        container.innerHTML = '';
        Object.keys(achievementConfig).forEach(achieveId => {
            const config = achievementConfig[achieveId];
            const isUnlocked = appData.achievements[trackerId] && appData.achievements[trackerId][achieveId];
            const card = document.createElement('div');
            card.className = `bg-slate-800 p-4 rounded-lg text-center flex flex-col items-center justify-center transition-all ${!isUnlocked ? 'achievement-locked' : ''}`;
            card.innerHTML = `
                <div class="text-4xl mb-2">${config.icon}</div>
                <p class="font-semibold text-sm">${config.name[currentLang]}</p>
            `;
            container.appendChild(card);
        });
    }
    
    function renderMotivationPage() {
        const container = document.getElementById('motivationPage');
        container.innerHTML = `
            <header class="mb-6">
                <h1 data-lang-key="motivation_title" class="text-3xl font-bold text-slate-100">${strings.motivation_title[currentLang]}</h1>
                <p data-lang-key="motivation_subtitle" class="text-slate-400">${strings.motivation_subtitle[currentLang]}</p>
            </header>
            <div class="space-y-6">
                <div>
                    <h2 data-lang-key="motivation_tips_title" class="text-xl font-bold text-blue-400 mb-3">${strings.motivation_tips_title[currentLang]}</h2>
                    <div class="space-y-3">
                        <div class="bg-slate-800 p-4 rounded-lg" data-lang-key="tip1">${strings.tip1[currentLang]}</div>
                        <div class="bg-slate-800 p-4 rounded-lg" data-lang-key="tip2">${strings.tip2[currentLang]}</div>
                        <div class="bg-slate-800 p-4 rounded-lg" data-lang-key="tip3">${strings.tip3[currentLang]}</div>
                        <div class="bg-slate-800 p-4 rounded-lg" data-lang-key="tip4">${strings.tip4[currentLang]}</div>
                        <div class="bg-slate-800 p-4 rounded-lg" data-lang-key="tip5">${strings.tip5[currentLang]}</div>
                    </div>
                </div>
                <div>
                    <h2 data-lang-key="motivation_quotes_title" class="text-xl font-bold text-blue-400 mb-3">${strings.motivation_quotes_title[currentLang]}</h2>
                    <div class="space-y-3">
                        <blockquote class="bg-slate-800 p-4 rounded-lg border-l-4 border-blue-500" data-lang-key="quote1">${strings.quote1[currentLang]}</blockquote>
                        <blockquote class="bg-slate-800 p-4 rounded-lg border-l-4 border-blue-500" data-lang-key="quote2">${strings.quote2[currentLang]}</blockquote>
                    </div>
                </div>
            </div>`;
    }

    function renderSettingsPage() {
        const container = document.getElementById('settingsContainer');
        container.innerHTML = '';
        
        let settingsHtml = `<div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
            <h3 class="text-xl font-bold mb-4 text-slate-200" data-lang-key="settings_lang_label">${strings.settings_lang_label[currentLang]}</h3>
            <div class="flex justify-center bg-slate-700 p-1 rounded-full w-fit mx-auto">
                <button id="langBnBtn" class="lang-btn font-semibold px-6 py-2 rounded-full text-sm ${currentLang === 'bn' ? 'active' : ''}">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
                <button id="langEnBtn" class="lang-btn font-semibold px-6 py-2 rounded-full text-sm ${currentLang === 'en' ? 'active' : ''}">English</button>
            </div>
        </div>`;

        Object.values(appData.trackers).forEach(tracker => {
            const unitName = tracker.settings.unitName[currentLang] || tracker.settings.unitName['en'];
            settingsHtml += `
                <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                    <h3 class="text-xl font-bold mb-4 ${tracker.gradient} bg-clip-text text-transparent">${tracker.name}</h3>
                    <form class="space-y-3" data-tracker-id="${tracker.id}" onsubmit="handleSettingsSave(event)">
                        <div>
                            <label class="text-sm text-slate-400">${strings.settings_daily_limit[currentLang]} (${unitName})</label>
                            <input type="number" name="dailyLimit" value="${tracker.settings.dailyLimit}" class="w-full bg-slate-700 p-2 rounded-md mt-1">
                        </div>
                        ${tracker.id !== 'urge' ? `
                        <div>
                            <label class="text-sm text-slate-400">${strings.settings_old_avg[currentLang]}</label>
                            <input type="number" name="oldAvg" value="${tracker.settings.oldAvg}" class="w-full bg-slate-700 p-2 rounded-md mt-1">
                        </div>
                        <div>
                            <label class="text-sm text-slate-400">${strings.settings_cost[currentLang]}</label>
                            <input type="number" name="cost" value="${tracker.settings.cost}" class="w-full bg-slate-700 p-2 rounded-md mt-1">
                        </div>
                        <div>
                            <label class="text-sm text-slate-400">${strings.settings_units[currentLang]}</label>
                            <input type="number" name="units" value="${tracker.settings.units}" class="w-full bg-slate-700 p-2 rounded-md mt-1">
                        </div>` : ''}
                        <button type="submit" data-lang-key="settings_save_btn" class="w-full font-bold py-2 px-4 rounded-md text-white ${tracker.gradient}">${strings.settings_save_btn[currentLang]}</button>
                    </form>
                </div>`;
        });
        
        settingsHtml += `
            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                <h3 data-lang-key="settings_export_title" class="text-lg font-semibold text-green-400 mb-2">${strings.settings_export_title[currentLang]}</h3>
                <p data-lang-key="settings_export_subtitle" class="text-sm text-slate-400 mb-4">${strings.settings_export_subtitle[currentLang]}</p>
                <button id="exportDataButton" data-lang-key="settings_export_btn" class="w-full gradient-premium text-white font-bold py-3 px-4 rounded-md">${strings.settings_export_btn[currentLang]}</button>
            </div>
            <div class="bg-red-900/50 p-4 rounded-xl border border-red-700">
                <h3 data-lang-key="settings_danger_zone" class="text-lg font-semibold text-red-400 mb-2">${strings.settings_danger_zone[currentLang]}</h3>
                <p data-lang-key="settings_reset_subtitle" class="text-sm text-slate-400 mb-4">${strings.settings_reset_subtitle[currentLang]}</p>
                <button id="resetDataButton" data-lang-key="settings_reset_btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-md">${strings.settings_reset_btn[currentLang]}</button>
            </div>`;

        container.innerHTML = settingsHtml;
        
        // Add event listeners for the newly created buttons
        document.getElementById('langBnBtn').addEventListener('click', () => setLanguage('bn'));
        document.getElementById('langEnBtn').addEventListener('click', () => setLanguage('en'));
        document.getElementById('exportDataButton').addEventListener('click', exportData);
        document.getElementById('resetDataButton').addEventListener('click', resetData);
    }

    window.handleSettingsSave = function(event) {
        event.preventDefault();
        const form = event.target;
        const trackerId = form.dataset.trackerId;
        const tracker = appData.trackers[trackerId];
        
        tracker.settings.dailyLimit = parseInt(form.elements.dailyLimit.value);
        if(form.elements.oldAvg) tracker.settings.oldAvg = parseInt(form.elements.oldAvg.value);
        if(form.elements.cost) tracker.settings.cost = parseFloat(form.elements.cost.value);
        if(form.elements.units) tracker.settings.units = parseInt(form.elements.units.value);
        
        saveData();
        alert(`${tracker.name} settings saved!`);
        renderDashboard();
    }
    
    function startTimer(trackerId, lastEntry) {
        if (timerIntervals[trackerId]) clearInterval(timerIntervals[trackerId]);
        const timerEl = document.getElementById(`timer-${trackerId}`);
        if (!timerEl) return;

        function update() {
            if (!lastEntry) {
                timerEl.textContent = strings['timer_start'][currentLang];
                return;
            }
            const diff = Date.now() - lastEntry;
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            timerEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
        }
        update();
        timerIntervals[trackerId] = setInterval(update, 1000);
    }
    
    function switchPage(pageId, forceRender = false) {
        pages.forEach(p => p.classList.toggle('active', p.id === pageId));
        navButtons.forEach(b => b.classList.toggle('active', b.dataset.page === pageId));
        
        if (pageId === 'dashboardPage' || forceRender) renderDashboard();
        if (pageId === 'insightsPage' || forceRender) renderInsightsPage();
        // Motivation and Settings are re-rendered on language change anyway
    }

    function switchInsightsTab(tabId, trackerId) {
        insightsTabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabId));
        insightsTabButtons.forEach(btn => btn.classList.toggle('text-slate-400', btn.dataset.tab !== tabId));
        insightsTabContents.forEach(content => content.classList.toggle('hidden', content.id !== `${tabId}Tab`));
        
        if (tabId === 'charts') {
            renderMainChart(trackerId);
            renderStatsSummary(trackerId);
        } else if (tabId === 'history') {
            renderHistory(trackerId);
        } else if (tabId === 'achievements') {
            renderAchievements(trackerId);
        }
    }

    function openModal() {
        const list = document.getElementById('modalTrackerList');
        list.innerHTML = '';
        selectedTrackerForModal = null; // Reset selection

        Object.values(appData.trackers).forEach(tracker => {
            const button = document.createElement('button');
            button.className = `w-full text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center border-2 border-transparent transition-all`;
            button.innerHTML = `${tracker.icon} <span class="ml-2">${tracker.name}</span>`;
            button.onclick = () => {
                document.querySelectorAll('#modalTrackerList button').forEach(btn => {
                    btn.classList.remove(...Object.values(appData.trackers).map(t => t.gradient), 'border-white');
                    btn.style.background = '#475569';
                });
                button.classList.add(tracker.gradient, 'border-white');
                button.style.background = '';
                selectedTrackerForModal = tracker.id;
            };
            button.style.background = '#475569'; // Default bg
            list.appendChild(button);
        });
        entryNote.value = '';
        addEntryModal.classList.remove('hidden');
    }
    
    function closeModal() {
        addEntryModal.classList.add('hidden');
    }
    
    function showToast(message) {
        toastEl.innerHTML = message;
        toastEl.classList.remove('translate-x-full');
        setTimeout(() => {
            toastEl.classList.add('translate-x-full');
        }, 3000);
    }

    function exportData() {
        const dataStr = JSON.stringify(appData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'lifetrack_pro_backup.json';
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }
    
    function resetData() {
        if(confirm(strings.confirm_reset[currentLang])){
            localStorage.removeItem('lifeTrackProData');
            loadData();
            setLanguage('bn'); // Reset to default language
            switchPage('dashboardPage');
        }
    }
    
    // --- EVENT LISTENERS ---
    navButtons.forEach(btn => btn.addEventListener('click', () => switchPage(btn.dataset.page)));
    addEntryBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);
    saveEntryBtn.addEventListener('click', () => logEntry(selectedTrackerForModal, entryNote.value));
    
    document.getElementById('insightsTrackerSelect').addEventListener('change', (e) => renderInsightsPage(e.target.value));
    insightsTabButtons.forEach(btn => btn.addEventListener('click', () => {
        const trackerId = document.getElementById('insightsTrackerSelect').value;
        switchInsightsTab(btn.dataset.tab, trackerId);
    }));

    function initializeApp() {
        loadData();
        setLanguage((appData.settings && appData.settings.language) || 'bn');
        renderAllPages();
        switchPage('dashboardPage');
        checkAllAchievements();
    }
    
    initializeApp();
    setInterval(checkAllAchievements, 60 * 1000); // Check for achievements every minute
});
    </script>
</body>
</html>

